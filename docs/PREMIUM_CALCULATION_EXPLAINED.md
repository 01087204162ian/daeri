# 보험료 산출 과정 설명 (초보자용)

## 📋 전체 흐름 개요

```
사용자가 "산출" 버튼 클릭
    ↓
담보 선택값 확인 (대인, 대물, 자손, 자차)
    ↓
각 나이대별로 보험료 계산
    ↓
계산 결과를 화면에 표시
```

---

## 1단계: 사용자가 "산출" 버튼 클릭

### 화면에서 일어나는 일
- 사용자가 담보를 선택합니다:
  - **대인**: 책임초과무한 또는 책임포함무한
  - **대물**: 3천, 5천, 1억, 2억 중 선택
  - **자손**: 3천, 5천, 1억 중 선택
  - **자차**: 1천, 2천, 3천 중 선택

- "산출" 버튼을 클릭합니다.

### 코드에서 일어나는 일
```javascript
// 사용자가 버튼을 클릭하면
onClick={handleCalculate}

// handleCalculate 함수가 실행됩니다
const handleCalculate = () => {
  setCalculated(true);  // "계산 완료" 상태로 변경
};
```

**의미**: "이제 계산을 시작하겠다"는 신호를 컴포넌트에 전달합니다.

---

## 2단계: 각 나이대별 보험료 계산

### 화면에서 일어나는 일
- 6개 나이대(26~30세, 31~45세, 46~50세, 51~55세, 56~60세, 61세 이상)에 대해 각각 계산합니다.
- 각 나이대마다 3가지 보험종목(대리, 탁송, 확대탁송)의 보험료를 계산합니다.

### 코드에서 일어나는 일
```javascript
// 각 나이대를 반복하면서
ageGroups.map((age) => {
  // 대리 보험료 계산
  const 대리보험료 = calculatePremium("대리", age.ageGroup);
  
  // 탁송 보험료 계산
  const 탁송보험료 = calculatePremium("탁송", age.ageGroup);
  
  // 확대탁송 보험료 계산
  const 확대탁송보험료 = calculatePremium("확대탁송", age.ageGroup);
})
```

**의미**: 각 나이대와 보험종목별로 보험료를 계산합니다.

---

## 3단계: 보험료 계산 함수 실행 (핵심!)

### calculatePremium 함수가 하는 일

#### 3-1. 사용자가 선택한 담보를 코드 형식으로 변환
```javascript
// 사용자가 선택한 값:
// - 대인: "책임초과무한" 또는 "책임포함무한"
// - 대물: "3천", "5천", "1억", "2억"
// - 자손: "3천", "5천", "1억"
// - 자차: "1천", "2천", "3천"

// 코드에서 사용하는 형식으로 변환:
const 대인 = "책임초과무한" → "대인2"
const 대물 = "3천" → "대물3천"
const 자손 = "3천" → "자손3천"
const 자차 = "1천" → "자차1천"
```

#### 3-2. 책임포함무한인지 확인
```javascript
if (daein === "책임포함무한") {
  // 책임포함무한 = 대인2 + 대인1특약
  // 두 가지를 모두 더해야 함
} else {
  // 책임초과무한 = 대인2만
}
```

**이유**: 
- **책임초과무한** = 대인2만 필요 (예: 278,450원)
- **책임포함무한** = 대인2 + 대인1특약 (예: 278,450원 + 263,020원 = 541,470원)

#### 3-3. calculateTotalPremium 함수 호출
```javascript
calculateTotalPremium(premiumData, "대리", "31~45", {
  대인: "대인2",
  대물: "대물3천",
  자손: "자손3천",
  자차: "자차1천",
  법률비용: true
})
```

---

## 4단계: 실제 보험료 더하기 (calculateTotalPremium 함수)

### 이 함수가 하는 일: **각 담보의 보험료를 모두 더합니다**

```javascript
function calculateTotalPremium(...) {
  let total = 0;  // 총액을 저장할 변수 (처음엔 0원)
  
  // 1. 대인 보험료 더하기
  if (대인을 선택했다면) {
    total = total + 대인보험료;
    // 예: total = 0 + 278,450 = 278,450
  }
  
  // 2. 대물 보험료 더하기
  if (대물을 선택했다면) {
    total = total + 대물보험료;
    // 예: total = 278,450 + 217,610 = 496,060
  }
  
  // 3. 자손 보험료 더하기
  if (자손을 선택했다면) {
    total = total + 자손보험료;
    // 예: total = 496,060 + 9,870 = 505,930
  }
  
  // 4. 자차 보험료 더하기
  if (자차를 선택했다면) {
    total = total + 자차보험료;
    // 예: total = 505,930 + 178,410 = 684,340
  }
  
  // 5. 법률비용 더하기 (항상 포함)
  total = total + 법률비용;
  // 예: total = 684,340 + 42,710 = 727,050
  
  return total;  // 최종 결과 반환
}
```

### 실제 계산 예시

**조건**: 대리, 31~45세, 책임초과무한, 대물3천, 자손3천, 자차1천

1. **대인2**: 278,450원
2. **대물3천**: 217,610원
3. **자손3천**: 9,870원
4. **자차1천**: 178,410원
5. **법률비용**: 42,710원

**계산 과정**:
```
0원 (시작)
+ 278,450원 (대인2)
= 278,450원

+ 217,610원 (대물3천)
= 496,060원

+ 9,870원 (자손3천)
= 505,930원

+ 178,410원 (자차1천)
= 684,340원

+ 42,710원 (법률비용)
= 727,050원 (최종 결과)
```

---

## 5단계: 보험료 데이터는 어디서 오나요?

### 데이터 흐름

```
MySQL 데이터베이스
    ↓
/api/premium-rates API 호출
    ↓
premiumData 변수에 저장
    ↓
calculateTotalPremium 함수에서 사용
```

### 1. 페이지가 처음 로드될 때
```javascript
useEffect(() => {
  // API를 호출해서 MySQL에서 데이터를 가져옵니다
  const data = await fetchPremiumRates();
  setPremiumData(data);  // 가져온 데이터를 저장
}, []);
```

### 2. API가 MySQL에서 조회하는 내용
```sql
SELECT 
  insurance_type,  -- 보험종목 (대리, 탁송, 확대탁송)
  age_group,       -- 나이대 (26~30, 31~45, ...)
  daein2,          -- 대인2 보험료
  daein1_special,  -- 대인1특약 보험료
  daemul_3천,      -- 대물3천 보험료
  ...              -- 기타 담보 보험료
FROM premium_rates
WHERE is_active = true  -- 활성화된 데이터만
```

### 3. 가져온 데이터 예시
```javascript
[
  {
    insurance_type: "대리",
    age_group: "31~45",
    daein2: 278450,
    daein1_special: 263020,
    daemul_3천: 217610,
    ...
  },
  {
    insurance_type: "탁송",
    age_group: "31~45",
    ...
  },
  ...
]
```

---

## 6단계: 화면에 결과 표시

### 계산된 보험료를 화면에 보여주기

```javascript
// 계산된 보험료
const 대리보험료 = 727,050원;
const 탁송보험료 = 1,234,567원;
const 확대탁송보험료 = 1,456,789원;

// 화면에 표시
<td>{대리보험료.toLocaleString()}원</td>
// → "727,050원"으로 표시됨
```

### 표시되는 내용
- **대리**: 대리운전 보험료만
- **일반탁송**: 탁송 보험료만
- **확대탁송**: 확대탁송 보험료만
- **대리+탁송**: 대리 + 탁송 합계
- **대리+확대**: 대리 + 확대탁송 합계

---

## 📊 전체 과정 요약 (한눈에 보기)

```
[사용자]
  ↓ 선택: 대인, 대물, 자손, 자차
  ↓ 클릭: "산출" 버튼
  ↓
[컴포넌트]
  ↓ handleCalculate() 실행
  ↓ calculated = true
  ↓
[각 나이대별로 반복]
  ↓ calculatePremium() 호출
  ↓
[보험료 계산]
  ↓ 담보 선택값 변환
  ↓ 책임포함무한인지 확인
  ↓ calculateTotalPremium() 호출
  ↓
[실제 계산]
  ↓ 대인보험료 + 대물보험료 + 자손보험료 + 자차보험료 + 법률비용
  ↓ 총액 반환
  ↓
[화면 표시]
  ↓ 각 나이대별 보험료 표시
  ↓ 사용자가 결과 확인
```

---

## 💡 핵심 포인트

### 1. 보험료는 어떻게 계산되나요?
**답**: 선택한 각 담보의 보험료를 모두 더합니다.
```
총 보험료 = 대인 + 대물 + 자손 + 자차 + 법률비용
```

### 2. 데이터는 어디서 오나요?
**답**: MySQL 데이터베이스에서 가져옵니다.
- 페이지 로드 시 `/api/premium-rates` 호출
- MySQL의 `premium_rates` 테이블에서 조회
- 활성화된 데이터만 사용

### 3. 책임포함무한과 책임초과무한의 차이는?
**답**: 
- **책임초과무한** = 대인2만 (예: 278,450원)
- **책임포함무한** = 대인2 + 대인1특약 (예: 278,450 + 263,020 = 541,470원)

### 4. 왜 6개 나이대를 모두 계산하나요?
**답**: 사용자가 자신의 나이에 맞는 보험료를 확인할 수 있도록 모든 나이대의 보험료를 보여줍니다.

---

## 🔍 디버깅 팁 (문제 해결)

### 보험료가 0원으로 나오는 경우
1. MySQL 데이터가 제대로 로드되었는지 확인
2. 브라우저 개발자 도구 → Network 탭에서 `/api/premium-rates` 확인
3. 담보 선택값이 올바른지 확인

### 계산 결과가 이상한 경우
1. MySQL의 `premium_rates` 테이블 데이터 확인
2. 선택한 담보와 계산 로직이 일치하는지 확인
3. 책임포함무한 계산 로직 확인

---

**작성일**: 2026-02-02  
**목적**: 보험료 산출 과정 초보자용 설명
